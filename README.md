# iot-hub
Кристијан Постолов 151067

Проект по веб програмирање (ФИНКИ).

Во проектот освен овој опис и упатство за стартување, има уште еден документ со подетален опис, упатство за стартување и користење на апликацијата и слики од функционалностите (iot-hub-docs.pdf)

## Опис на проектот
IOT-Hub е веб апликација на која корисниците ќе можат да прегледуваат и праќаат податоци на нивните iot(internet of things) уреди. За комуникација со уредите, апликацијата користи MQTT протокол за праќање на пораки. Притоа, за да може уредот да комуницира со системот, првин треба да се програмира според интерфејсот дефиниран од IOT-Hub за да праќа и прима пораки до MQTT серверот.
Корисниците би можеле да ги извршуваат следниве операции:
- Регистрација и најава на апликацијата
- Креирање на уред во системот – внесува име и опис на уредот, а апликацијата генерира идентификатор со чија помош уредот ќе комуницира со системот.
- Преглед и пребарување на уредите кои ги креирал корисникот – корисникот ќе може да ги погледне деталите за уредите како што се име, опис, идентификатор, статус (inactive, paired, active), статус на параметрите што ги има уредот (сензори и актуатори)
- Менување на вредност на параметри – корисникот преку апликацијата би можел да смени вредност на некој од актуаторите (пр. Вклучување на клима преку уредот).
- Преглед на параметрите во форма на график

Уредите би можеле да комуницираат со системот на следниот начин:
- Config порака – употребувајќи го идентификаторот кој го добил корисникот при креирање на уредот, праќа порака за конфигурирање на уредот. Во оваа порака уредот ги праќа своите параметри (име на параметар, тип на податок, дали може да се контролира преку апликацијата). Оваа порака би го сменила статусот на уредот од inactive во paired. Пораката би можела да се прати повторно за конфигурирање на нови параметри.
- State порака – порака со која уредот праќа нов статус за еден или повеќе параметри (читање на сензор, менување на состојба на актуатор).
- StatePush порака – оваа порака ја праќа системот до уредот, и означува дека корисникот ја променил состојбата на некој од параметрите. (пр. Вклучување на светлина).

## Користени технологии

При имплементација на апликацијата опфатени се следниве технологии:
1. Spring boot – за backend модулот од проектот со кој комуницираат корисниците преку frontend апликацијата и уредите преку mqtt протокол
2. Angular – за frontend порталот кој го користат корисниците за прегледување на податоци од своите уреди и испраќање на команди до истите
3. Mosquitto broker – сервер преку кои би комуницирале backend-от и уредите
4. Eclipse paho – библиотека за mqtt комуникација
5. Spring security – автентикација базирана на JWT (json web token) за автентицирање/авторизирање на корисниците преку HTTP
6. H2 и Postgre – бази на податоци, можност за користење на апликацијата без конфигурирање на посебна база со помош на h2
7. Chart.js – библиотека за приказ на графови


## Стартување на проектот

Проектот може да се најде на https://github.com/KristijanPostolov/iot-hub . Во овој проект се наоѓаат backend, frontend и device-simulator(за тестирање на системот без вистински физички iot уреди) модули. Пред да се стартуваат апликациите, треба на локалната машина да имаме инсталирано и стартувано Mosquitto broker. Овој процес е едноставен и е опишан на https://www.roytuts.com/how-to-install-mosquitto-mqtt-in-windows/ или https://www.vultr.com/docs/how-to-install-mosquitto-mqtt-broker-server-on-ubuntu-16-04 (многу лесно може да се најде истото и за други оперативни системи). Овој сервер се стартува на порта 1883, но доколку се стартува на друга порта, тоа треба да се смени и во application.properties (mqtt.connectionUrl) на backend модулот и на симулаторот.

Возможно е да се стартува проектот и без mosquito, но со ограничени функционалности (автентикација, креирање и преглед на уреди) со тоа што сервисот воопшто не би комуницирал со уредите(симулаторите). За да се постигне ова, во application.properties треба да се смени полето mqtt.enabled во false.

Проектот е поставен да работи со h2 база (in memory), затоа не е потребно да се креира нова база, но тоа значи дека при рестартирање на backend модулот, сите податоци се губат. За да работи со PostgreSQL база, доволно е да се направи промена во application.properties со тоа што ќе се избришат конекциските параметри за h2, а ќе се од-коментираат параметрите за postgres и соодветно ќе се внесат конекцискиот стринг и credentials.

За frontend модулот, ќе треба да се отвори терминал во модулот и да се внесе npm install, за да се симнат бараните библиотеки.

За стартување на frontend и backend апликациите, веќе има поставени shared run configurations za intellij и единствено треба да се клинке run или debug. Истото важи и за симулаторот.